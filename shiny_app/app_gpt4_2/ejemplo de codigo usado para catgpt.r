Can you make the following R code into a Shiny app that takes a dataframe and outputs the respective tables and graphics in the app? The app should have the option to download the respective table and/or image generated by the app. Make the changes you wish in order to make a better code. The code is the following:


# import libraries
library(tidyverse)
library(stringr)

# read dataframe
raw_data <- read.csv("example.csv")

# Clean the dataframe

clean_dataframe <- raw_data |>
  group_by(variable_1, variable_2) |>
  filter(str_detect(Stage, "some_string_example")) |>
  select(variable_1, # selecciona columnas con variables de interes
         variable_2, 
         variable_3, 
         variable_4)


# get the N, average, standard deviation and standard error of the numeric variables in our clean_dataframe 

summary_of_variables <- clean_dataframe |>
  group_by(variable_1, variable_2) %>%
  dplyr::summarise( 
    # variable_1
    N_variable_1  = sum(!is.na(variable_1)), # get the N
    average_variable_1 = mean(variable_1, na.rm=TRUE), # get average of variable_1
    sd_variable_1 = sd(variable_1, na.rm=TRUE), # get standard deviation of variable_1
    se_variable_1 = sd_variable_1 / sqrt(N_variable_1), # get standard error of variable_1
    # variable_2
    N_variable_2  = sum(!is.na(variable_2)), # get the N
    average_variable_2 = mean(variable_2, na.rm=TRUE), # get average of variable_2
    sd_variable_2 = sd(variable_2, na.rm=TRUE), # get standard deviation of variable_2
    se_variable_2 = sd_variable_2 / sqrt(N_variable_2), # get standard error of variable_2
    # variable_3
    N_variable_3  = sum(!is.na(variable_3)), # get the N
    average_variable_3 = mean(variable_3, na.rm=TRUE), # get average of variable_3
    sd_variable_3 = sd(variable_3, na.rm=TRUE), # get standard deviation of variable_3
    se_variable_3 = sd_variable_3 / sqrt(N_variable_3), # get standard error of variable_3
    # variable_4
    N_variable_4  = sum(!is.na(variable_4)), # get the N
    average_variable_4 = mean(variable_4, na.rm=TRUE), # get average of variable_4
    sd_variable_4 = sd(variable_4, na.rm=TRUE), # get standard deviation of variable_4
    se_variable_4 = sd_variable_4 / sqrt(N_variable_4) # get standard error of variable_4
  )


# Graph the variable_1

ggplot(
  data = summary_of_variables, 
  aes(
    x = x, 
    y = variable_1, 
    colour = Treatment)) +
  geom_point(aes(
    colour = Treatment), 
    alpha = 1, 
    size = 4) +
  geom_line(aes(
    group = Treatment)) +
  scale_color_manual(
    values = c("#ff1493", "#4c00ff")) +
  geom_errorbar(aes(
    ymin = average_variable_1 - se_variable_1, 
    ymax = average_variable_1 + se_variable_1), width = .1, size = 1) +
  labs(
    title = "variable_1 Title",
    subtitle = "variable_1 subtitle",
    caption = "variable_1 caption" ,
    x = "x lable",
    y = "y_lable"
  ) +
  theme(
    plot.margin = unit(c(1,1,1,1), "cm"),
    panel.background = element_blank(),
    axis.line = element_line(color = "#1209c8"),
    axis.title = element_text(size=13, color="black", 
                              face="bold"),
    axis.text = element_text(size = 7, color = "black"),
    axis.text.y = element_text(size=10), 
    axis.ticks.x = element_blank(),
    axis.text.x = element_text(margin = margin(t=5)),
    axis.title.y=element_text(margin = margin(r=10)),
    legend.position = c(.9,1.2),
    legend.text = element_text(size=10),
    legend.background = element_rect(color="black")) 

# Graph the variable_2

ggplot(
  data = summary_of_variables, 
  aes(
    x = x, 
    y = variable_2, 
    colour = Treatment)) +
  geom_point(aes(
    colour = Treatment), 
    alpha = 1, 
    size = 4) +
  geom_line(aes(
    group = Treatment)) +
  scale_color_manual(
    values = c("#ff1493", "#4c00ff")) +
  geom_errorbar(aes(
    ymin = average_variable_2 - se_variable_2, 
    ymax = average_variable_2 + se_variable_2), width = .1, size = 1) +
  labs(
    title = "variable_2 Title",
    subtitle = "variable_2 subtitle",
    caption = "variable_2 caption" ,
    x = "x lable",
    y = "y_lable"
  ) +
  theme(
    plot.margin = unit(c(1,1,1,1), "cm"),
    panel.background = element_blank(),
    axis.line = element_line(color = "#1209c8"),
    axis.title = element_text(size=13, color="black", 
                              face="bold"),
    axis.text = element_text(size = 7, color = "black"),
    axis.text.y = element_text(size=10), 
    axis.ticks.x = element_blank(),
    axis.text.x = element_text(margin = margin(t=5)),
    axis.title.y=element_text(margin = margin(r=10)),
    legend.position = c(.9,1.2),
    legend.text = element_text(size=10),
    legend.background = element_rect(color="black")) 

# Graph the variable_3

ggplot(
  data = summary_of_variables, 
  aes(
    x = x, 
    y = variable_3, 
    colour = Treatment)) +
  geom_point(aes(
    colour = Treatment), 
    alpha = 1, 
    size = 4) +
  geom_line(aes(
    group = Treatment)) +
  scale_color_manual(
    values = c("#ff1493", "#4c00ff")) +
  geom_errorbar(aes(
    ymin = average_variable_3 - se_variable_3, 
    ymax = average_variable_3 + se_variable_3), width = .1, size = 1) +
  labs(
    title = "variable_3 Title",
    subtitle = "variable_3 subtitle",
    caption = "variable_3 caption" ,
    x = "x lable",
    y = "y_lable"
  ) +
  theme(
    plot.margin = unit(c(1,1,1,1), "cm"),
    panel.background = element_blank(),
    axis.line = element_line(color = "#1209c8"),
    axis.title = element_text(size=13, color="black", 
                              face="bold"),
    axis.text = element_text(size = 7, color = "black"),
    axis.text.y = element_text(size=10), 
    axis.ticks.x = element_blank(),
    axis.text.x = element_text(margin = margin(t=5)),
    axis.title.y=element_text(margin = margin(r=10)),
    legend.position = c(.9,1.2),
    legend.text = element_text(size=10),
    legend.background = element_rect(color="black")) 

# Graph the variable_4

ggplot(
  data = summary_of_variables, 
  aes(
    x = x, 
    y = variable_4, 
    colour = Treatment)) +
  geom_point(aes(
    colour = Treatment), 
    alpha = 1, 
    size = 4) +
  geom_line(aes(
    group = Treatment)) +
  scale_color_manual(
    values = c("#ff1493", "#4c00ff")) +
  geom_errorbar(aes(
    ymin = average_variable_4 - se_variable_4, 
    ymax = average_variable_4 + se_variable_4), width = .1, size = 1) +
  labs(
    title = "variable_4 Title",
    subtitle = "variable_4 subtitle",
    caption = "variable_4 caption" ,
    x = "x lable",
    y = "y_lable"
  ) +
  theme(
    plot.margin = unit(c(1,1,1,1), "cm"),
    panel.background = element_blank(),
    axis.line = element_line(color = "#1209c8"),
    axis.title = element_text(size=13, color="black", 
                              face="bold"),
    axis.text = element_text(size = 7, color = "black"),
    axis.text.y = element_text(size=10), 
    axis.ticks.x = element_blank(),
    axis.text.x = element_text(margin = margin(t=5)),
    axis.title.y=element_text(margin = margin(r=10)),
    legend.position = c(.9,1.2),
    legend.text = element_text(size=10),
    legend.background = element_rect(color="black")) 


